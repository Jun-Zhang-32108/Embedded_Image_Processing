/* Date: 2019-2-5
 * Author: Jun Zhang, Jaakko Laiho
 * Description: An image processing program that captures the required pattern in each frame of the input flow
 */

/*
To do list 1: Free the all the dynamic 2D array
To do list 2: Test  the functions after Func crop
 */

#include <stdio.h>
#include <stdlib.h>

//Path:\il2212-lab-master\app\hello_image\src_0
//Contain the RGB value of tesing image. Using this test .h file can avoid reading data from the PPM file. 
#include "images.h"


//Just for testing. Int Nios2 two, we have INT16U. But to test the program in a normal compilor, we need to define a 
//new datatype or rename the int to INT16U. We cam simply comment this line when testing in the board.
typedef int INT16U;

INT16U dSPAN = 15;
INT16U cropSIZE = 31; //cropSIZE = 2 * dsPAN + 1;
INT16U xPATTERN[5][5] = {{0,0,1,0,0},
					  {0,1,0,1,0},
					  {1,0,0,0,1},
					  {0,1,0,1,0},
					  {0,0,1,0,0}};					  
INT16U xPATTERN_length = 5;
INT16U offset_size_length = 27; // offset_size_length = cropSIZE - 4
INT16U test[] = { 36, 36, 255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
				, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255, 1,2,3,4,5,6,7,8,9, 11,12,13,14,15,16,17,18,19, 21,22,23,24,25,26,255,255,255
};
INT16U INT16U_poINT16Uer_size = sizeof(INT16U*);
INT16U INT16U_size = sizeof(INT16U);


void printMatrix(INT16U **inputMatrix, INT16U matrix_h, INT16U matrix_w)
{
	INT16U i;
	INT16U j;
	printf("============================================================\n");
	printf("============================================================\n");
	printf("\n");
	printf("[");
	for(i = 0; i < matrix_h; i++)
	{
		printf("[	");
		for(j = 0; j < matrix_w; j++)
		{
			//printf("(%d, %d)  %d	",i,j,*(*inputMatrix+matrix_w*i+j));
			//printf("(%d, %d)  %d	",i,j,inputMatrix[i][j]);
			printf("  %d	",inputMatrix[i][j]);
		}
		printf("]");
		printf("\n");
	}
	printf("]");
	printf("============================================================\n");
	printf("============================================================\n");
	printf("\n");
}

// transform the input input list to a 2D-matrix with the size of img_h * (img_w * 3)
INT16U ** matrix(INT16U *source, INT16U matrix_h, INT16U matrix_w)
{
	INT16U i;
	INT16U j;
    INT16U **group = (INT16U **) calloc(matrix_h, INT16U_poINT16Uer_size);
    if(group == NULL)
    {
    	printf("Calloc Error!\n");
    	exit;
    }
    group[0] = (INT16U*)calloc(matrix_h*matrix_w, INT16U_size);
    if(group[0] == NULL)
    {
    	printf("Calloc Error!\n");
    	exit;
    }
	for( i = 0; i< matrix_h; i++)
	{
		group[i] = group[0] + matrix_w*i;
		for( j = 0; j < matrix_w; j++)
		{
			group[i][j] = *(source+i*matrix_w+j);
			//printf("group %d %d Value : %d\n", i,j,&group[i][j]);
		}
	}
	//printf("*group:    %d\n",*group);
	//printf("group:    %d\n",group);
	//printf("group[0]:   %d\n",group[0]);
	printMatrix(group, matrix_h, matrix_w);
	return group;
}

// transform RGB value to grayscale value
// Input: a 2D-matrix with the size of img_h * (img_w * 3), img_h, img_w
// Output: a 2D-matrix with the size of img_h * img_w
INT16U ** groupV_3(INT16U **inputMatrix, INT16U matrix_row, INT16U matrix_col)
{
	INT16U i;
	INT16U j;
	INT16U **group = (INT16U**)calloc(matrix_row, INT16U_poINT16Uer_size);
    if(group == NULL)
    {
    	printf("Calloc Error!\n");
    	exit;
    }
    group[0] = (INT16U*)calloc(matrix_col*matrix_row, INT16U_size);
    if(group[0] == NULL)
    {
    	printf("Calloc Error!\n");
    	exit;
    }
	for ( i = 0; i < matrix_row; i++)
	{
		group[i] = group[0] + matrix_col * i;
		for(j = 0; j < matrix_col*3; j = j+3)
		{
			//one algorithm to transform RGB value to grayscale value which is suitable for operation between 16-bit variables
			//the good balance between speed and precision
			group[i][j/3] = ((inputMatrix[i][j]*38
						 +inputMatrix[i][j+1]*75
						 +inputMatrix[i][j+2]*15)>>7);
		}		
	}
	printf("Grayed Matrix\n");
	printMatrix(group, matrix_row, matrix_col);
	return group;
}

INT16U** crop(INT16U startingPoINT16U_x, INT16U startingPoINT16U_y, INT16U** inputMatrix, INT16U img_w)
{
	INT16U i;
	INT16U j;
	INT16U* startingPoINT16UAddress = inputMatrix[0]+img_w * startingPoINT16U_x + startingPoINT16U_y;
	printf("Staring Point Address: %d\n", startingPoINT16UAddress); 
	INT16U** group = (INT16U**)calloc(cropSIZE, INT16U_poINT16Uer_size);
    if(group == NULL)
    {
    	printf("Calloc Error!\n");
    	exit;
    }
    group[0] = (INT16U*)calloc(cropSIZE*cropSIZE, INT16U_size);
    if(group[0] == NULL)
    {
    	printf("Calloc Error!\n");
    	exit;
    }
	for ( i = 0; i < cropSIZE; i++)
	{
		group[i] = group[0] + i*cropSIZE;
		for( j = 0; j < cropSIZE; j++)
		{
			group[i][j] = *(startingPoINT16UAddress + img_w*i + j); 
		}		
	}
	printf("Cropped Matrix\n");
	printMatrix(group, cropSIZE, cropSIZE);
	return group;
}

//Optimization poINT16Uï¼š store the INT16Uermediate value to speed up the program
INT16U** xcorr2(INT16U** inputMatrix, INT16U** xPATTERN)
{
	INT16U i = 0;
	INT16U j = 0;
	INT16U m = 0;
	INT16U n = 0;
	INT16U product = 0;
	INT16U sum;
	INT16U output_size_length = offset_size_length;
	INT16U* startingPoINT16UAddress;
	INT16U** group = (INT16U**)calloc(output_size_length, sizeof(INT16U*));
	for (; i < output_size_length; i++)
	{
		group[i] = (INT16U*)calloc(output_size_length, sizeof(INT16U));
		for(; j < output_size_length; j++)
		{
			sum = 0;
			startingPoINT16UAddress = *inputMatrix + output_size_length*i + j;
			for( m; m < xPATTERN_length; m++)
			{
				for( n; n < xPATTERN_length; n++)
				{
					if((*((INT16U *)xPATTERN+xPATTERN_length*m+n))>0)
						product = *(startingPoINT16UAddress + m*xPATTERN_length + n);
					else
						product = 0;
					sum = sum + product;
				}
			}
			group[i][j] = sum; 			
		}		
	}
	return group;
}

INT16U* posMax(INT16U** inputMatrix)
{
	INT16U* output = (INT16U*)calloc(3, sizeof(INT16U));
	INT16U i = 0;
	INT16U j = 0;
	INT16U max = 0;
	for(; i<offset_size_length; i++)
		for(; j <offset_size_length; j++)
		{
			if(max < *(*inputMatrix+offset_size_length*i+j))
				max = *(*inputMatrix+offset_size_length*i+j);
				output[0] = i;
				output[1] = j;
				output[2] = max;
		}
	return output; 
}

INT16U* calcCoord(INT16U img_w, INT16U img_h, INT16U previousPoINT16U[2])
{
	INT16U* output = (INT16U*)calloc(2, sizeof(INT16U));
	if(previousPoINT16U[0] <= dSPAN)
		output[0] = 0;
	else if (previousPoINT16U[0] > (img_w - dSPAN))
		output[0] = img_w - cropSIZE -1;
	else
		output[0] = previousPoINT16U[0] - dSPAN - 1;
	if(previousPoINT16U[1] <= dSPAN)
		output[1] = 0;
	else if (previousPoINT16U[1] > (img_h - dSPAN))
		output[1] = img_h - cropSIZE -1;
	else
		output[1] = previousPoINT16U[1] - dSPAN - 1;
	return output;
}

INT16U* objectPos(INT16U cropPoINT16U[2], INT16U offset[2])
{
	INT16U* output = (INT16U*)calloc(2, sizeof(INT16U));
	output[0] = cropPoINT16U[0] + offset[0];
	output[1] = cropPoINT16U[1] + offset[1];
	return output;
}

INT16U main()
{
	//each image is represented by a list
	//First value of the list is the value of image height
	//Second value of the list is the value of the real value of image weight
	//Third value of the list is the value of maximum color
	//Later is the R, G, B values of each pixel point, respectively, all the RGB values are oganized in an consecutive order accroding to C language convention
	//int* test = test_ppm_1;
	INT16U img_h = test[0];
	INT16U img_w = test[1];
	//Extended by the RGB value
	INT16U img_w_0 = img_w * 3;
	//Start from the first R value 
    INT16U **Matrix_ = matrix(test+3, img_h, img_w_0);
    printf("size of INT16U: %d \n", sizeof(INT16U));
    printf("size of INT16U*: %d \n", sizeof(INT16U*));
    printf("Matrix_ Value: %d \n", Matrix_);
    printf("Matrix[0] Value: %d \n", Matrix_[0]);
    INT16U **grayed = groupV_3(Matrix_, img_h, img_w);
    printf("grayed[1][2]] Address: %d \n", &grayed[1][2]);
    INT16U **croped = crop(1,2,grayed, img_w);
    
	return 0;
}
